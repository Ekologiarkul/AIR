---
title: "R Notebook"
output: html_notebook
---

- it seems that the shift of a month in some cases leads to weird data results






Looking at one year of data from device SN000-72 of the East Boston network. The studied factors will be bin 0 to 3 and carbon monoxide. Analysis will begin with searching for anomalies and outliers within the dataset, as well as looking at numbers of missing data points. It will continue with a seasonal analysis incorporating windrose, pollution rose, metereology and polarrose plots. Profiles over reasonable timescales with dional plot will also be made.


The very start, loading in a year of data, formatting local timestamp. Sample output is generated 

It turns out that the funky wind data must be synced from another device, this will be done with the help of device 62. 
```{r}
year <- read.csv("SN00072_26feb19-26feb20.csv", header = TRUE)
windyear <- read.csv("WIND_62_26feb19-26feb20.csv", header = TRUE)
oldTImestamp72 <- year$timestamp_local
oldTImestamp67 <- windyear$timestamp_local

library(anytime)
year$timestamp_local <- anytime(as.factor(year$timestamp_local))

windyear$timestamp_local <- anytime(as.factor(windyear$timestamp_local))



```

```{r}
x <- year$timestamp_local[10000]
x
y <- windyear$timestamp_local[10000]
y
class(x)
class(y)
xx <- format(y, format='%y:%m:%d %H:%M')
yy <- format(x, format ='%y:%m:%d %H:%M')
xx
yy

xx > yy




```

OK, now that we have the data and a proper format of the timestamps, lets pick out the variables that will be interesting to us. These are the previously mentioned pollutants as well as som metereological data: solar intensity, wind speed and direction, temperature and pressure. These will allso be searched for anomalies.


All of the metereological parameters seems to have some outliers within the dataset. Solar and temp sensors seems to have been down in the shift aug/sep, sep/okt and okt/nov. Wind and pressure also seems to be following patterns of anomalies even though Wind have long periods of what seems to be zero values, in fact the median wind value is zero. 



```{r}
  
count67 <- 1
count72 <- 1
myCount <- 1
myWD <- c()
myWS <- c()

for (i in year$timestamp_local[1:length(windyear$timestamp_local)]) { 
  # formats current timestamps to something that is comparable
  c67 <- format(windyear$timestamp_local[count67], format ='%y:%m:%d %H:%M')
  c72 <- format(year$timestamp_local[count72], format ='%y:%m:%d %H:%M')
  if (myCount == length(year$timestamp_local)) {
    break
  } else if(c67 == c72) {
    myWD[myCount] = windyear$wind_dir[count67]
    myWS[myCount] = windyear$wind_speed[count67]
    myCount <- myCount + 1
    count67 <- count67 +1 
    count72 <- count72 + 1
  }  else if ( c67 < c72 ) { # missing value in 67
    "missing 67"
    count72 <- count72 + 1
  } else {
    "missing 72"
    count67 <- count67 + 1}
}
  

length(myWD)
windyear$timestamp_local[123:126] ; year$timestamp_local[123:126]







```




```{r}
 




solar <- year$solar
temp <- year$temp_box
pressure <- year$pressure
wd_62 <- windyear$wind_dir
ws_62 <- windyear$wind_speed
wd <- year$wind_dir
ws <- year$wind_speed

"solar"
summary(solar)
"wind speed 62"
summary(ws_62)
"wind speed"
summary(ws)
"wind direction"
summary(wd)
"wind dire 62"
summary(wd_62)
"temp"
summary(temp)
"pressure"
summary(pressure)


plot(year$timestamp_local, solar, type = "l", main = "solar", xlab = "date")

plot(year$timestamp_local, ws, type = "l", main = "wind speed", xlab = "date")


plot(year$timestamp_local, temp, type = "l", main = "temperature", xlab = "date")

plot(year$timestamp_local, pressure, type = "l", main = "pressure", xlab = "date")

plot(year$timestamp_local, wd, type = "l", main = "wind direction", xlab = "date")



```


Now that we have basic plots to understand some metereological behaviours we can move on to the actual air pollutants. First out is our champion: Carbon Monoxide.

It has no missing values in the past year. 
There is however values that are very high, however, they are of a number that makes it hard to instantaneously call them outliers. Is it possible that they are generated by favoring winds combined with airport activity? could be interesting to look closer at the summer months.  
There seems to be a pattern of more carbon monoxide during the summer? can this be explained by air chemistry? 

We have some weird dataoints at the same aug/sep/okt/nov month shifts. what happens here? in this case the sensor does not seem to be jsut down but spiking hard the first month, smaller the second and then down ending with a spike the last.

```{r}
CO <- year$co_we
summary(CO)

CO_dens <- density(CO, na.rm = TRUE)
plot(CO_dens, main = "Density plot of carbon monoxide")

plot(year$timestamp_local, CO, type = "l", main = "Carbon monoxide", xlab = "date")


```

Looking further into carbon monoxide we will try and create some more exiting plots: Windrose, pollutionrose and polar plots.

```{r}
library(openair)
summary(ws)
summary(wd)
WD_data <- data.frame(year$timestamp_local, ws, wd)

## windRose(WD_data)


```


















The second champion of our show is a trio, bin 0-3. These sensors show particle sizes of 300 nm - 700 nm ? approximately. Like carbon monoxide, these are the products of combustion.

Again we have no missing values.
Distribution seems to decrease as we move up in bin size


```{r}
b0 <- year$bin0
b1 <- year$bin1
b2 <- year$bin2
b3 <- year$bin3

summary(b0)
summary(b1)
summary(b2)
summary(b3)

b0_dens <- density(b0, na.rm = TRUE)
plot(b0_dens, main = "Density plot bin 0")

b1_dens <- density(b1, na.rm = TRUE)
plot(b1_dens, main = "Density plot bin 1")

b2_dens <- density(b2, na.rm = TRUE)
plot(b2_dens, main = "Density plot bin 2")

b3_dens <- density(b3, na.rm = TRUE)
plot(b3_dens, main = "Density plot bin 3")
```


Looking at the timeseries for the different bin sizes. First observations are that the concentrations seems to be much much higher during the summer months, just like carbon monoxide. The bin sensors also seems to have been down during the same month shifts as solar/

```{r}
plot(year$timestamp_local, b0, type = "l", main = "b0", xlab = "date")

plot(year$timestamp_local, b1, type = "l", main = "b1", xlab = "date")

plot(year$timestamp_local, b2, type = "l", main = "b2", xlab = "date")

plot(year$timestamp_local, b3, type = "l", main = "b3", xlab = "date")
```


sasas
```{r}
font(9)
```

